l_info("Consolidating information on active purse seiners...")

# PURSE SEINERS ####

# Format the year
ACTIVE_PS[, YEAR := as.numeric(YEAR)]

# Harmonize vessel names
ACTIVE_PS[VESSEL_NUMBER == "IOTC000178", VESSEL := "JUAN RAMON EGANA"]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000354", VESSEL := "MEN CREN"]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000367", VESSEL := "KERSAINT DE COETNEMPREN"]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000358", VESSEL := "VIA EUROS"]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000139", VESSEL := "ALBACORA SEIS"]
ACTIVE_PS[VESSEL_NUMBER == "IOTC016208", VESSEL := "GALERNA II"]    # 2 distinct IOTC numbers!
ACTIVE_PS[VESSEL_NUMBER == "IOTC015856", VESSEL := "GALERNA III"]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000193", VESSEL := "TXORI TOKI"]
ACTIVE_PS[VESSEL_NUMBER == "IOTC003874", VESSEL := "DRENNEC"]
ACTIVE_PS[VESSEL_NUMBER == "IOTC003810", VESSEL := "TREVIGNON"]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000161", VESSEL := "ALBACORA CUATRO"]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000171", VESSEL := "CAMPOLIBRE ALAI"]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000180", VESSEL := "MAR DE SERGIO"]
ACTIVE_PS[VESSEL_NUMBER == "IOTC001238", VESSEL := "TAIKEI MARU No.1"]
ACTIVE_PS[VESSEL_NUMBER == "IOTC001371", VESSEL := "27 HAKKO MARU"]
ACTIVE_PS[VESSEL_NUMBER == "IOTC001579", VESSEL := "TOMI MARU No.63"]
ACTIVE_PS[VESSEL_NUMBER == "IOTC001729", VESSEL := "85 FUKUICHI MARU"]
ACTIVE_PS[VESSEL_NUMBER == "IOTC001735", VESSEL := "86 GENPUKU MARU"]

# Same vessels with two distinct IOTC numbers
#ACTIVE_PS[, .(N = length(unique(VESSEL_NUMBER))), keyby = .(VESSEL)][N>1]

# Correct obvious error in IOTC numbers
ACTIVE_PS[VESSEL == "ADRIA" & YEAR %in% 2017, VESSEL_NUMBER := "IOTC000369"]
ACTIVE_PS[VESSEL == "ALBACAN" & YEAR %in% 2016:2017, VESSEL_NUMBER := "IOTC000159"]
ACTIVE_PS[VESSEL == "ALBACORA CUATRO" & YEAR %in% 2016:2017, VESSEL_NUMBER := "IOTC000161"]
ACTIVE_PS[VESSEL == "BELOUVE", `:=` (VESSEL_NUMBER = "IOTC014063", GT = 2667)]
ACTIVE_PS[VESSEL == "BERNICA", `:=` (VESSEL_NUMBER = "IOTC009828", LOA = 89.4)]
ACTIVE_PS[VESSEL == "FRANCHE TERRE", `:=` (VESSEL_NUMBER = "IOTC008743", LOA = 89.4, GT = 2664)]
ACTIVE_PS[VESSEL == "GALERNA II", `:=` (VESSEL_NUMBER = "IOTC016208")]
ACTIVE_PS[VESSEL == "ITSAS TXORI", `:=` (LOA = 95.8, VESSEL_NUMBER = "IOTC015353")]     # LOA!!! https://www.marinetraffic.com/en/ais/details/ships/shipid:992639/mmsi:225455000/imo:9702869/vessel:ITSAS_TXORI
ACTIVE_PS[VESSEL == "KOYO MARU NO.88", VESSEL_NUMBER := "IOTC016028"]
ACTIVE_PS[VESSEL == "MANAPANY", `:=` (VESSEL_NUMBER = "IOTC009131", LOA = 89.4, GT = 2666)]
ACTIVE_PS[VESSEL == "PLAYA DE ANZORAS", `:=` (VESSEL_NUMBER = "IOTC000186", LOA = 85.5, GT = 2446)]
ACTIVE_PS[VESSEL == "PLAYA DE ARITZATXU", `:=` (VESSEL_NUMBER = "IOTC000187", LOA = 86.7, GT = 2458)]

ACTIVE_PS[VESSEL == "PLAYA DE NOJA", `:=` (VESSEL_NUMBER = "IOTC000176", LOA = 77.3, GT = 2110)] #same IOTC number as FELIPE RUANO?

# Harmonize gear and vessel type
ACTIVE_PS[, `:=` (GEAR_CODE = "PS", GEAR = "Purse seine")]
ACTIVE_PS[, VESSEL_TYPE := "Purse seiner"]

# Harmonize LOA and GT
#ACTIVE_PS[, .(LOA_MIN = min(LOA), LOA_MAX = max(LOA), SD_LOA = sd(LOA)), keyby = .(VESSEL_NUMBER, VESSEL)][SD_LOA>0][order(VESSEL_NUMBER)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000138", `:=` (LOA = 101.66, GT = 4428)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000141", `:=` (LOA = 71.35, GT = 2232)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000143", `:=` (LOA = 71.35, GT = 2232)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000159", `:=` (LOA = 85.85, GT = 2232)]   # LOA corrected according to RAV ALBACAN
ACTIVE_PS[VESSEL_NUMBER == "IOTC000161", `:=` (LOA = 83.45, GT = 2082)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000171", `:=` (LOA = 69.61, GT = 2214)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000172", `:=` (LOA = 109.3, GT = 3674)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000175", `:=` (LOA = 80, GT = 2217)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000176", `:=` (LOA = 77.3, GT = 2210)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000178", `:=` (LOA = 77.3, GT = 2107)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000180", `:=` (LOA = 84.2, GT = 2767)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000182", `:=` (LOA = 73.02, GT = 2160)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000185", `:=` (LOA = 69.2, GT = 2058)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000188", `:=` (LOA = 75.6, GT = 2101)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000193", `:=` (LOA = 106.5, GT = 4134)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000194", `:=` (LOA = 63.3, GT = 1286)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000195", `:=` (LOA = 73.9, GT = 1823)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000345", `:=` (LOA = 79.59, GT = 2137)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000354", `:=` (LOA = 79.8, GT = 2119)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000365", `:=` (LOA = 81.9, GT = 2255)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000366", `:=` (LOA = 81.9, GT = 2255)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000812", `:=` (LOA = 106.5, GT = 4134)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000815", `:=` (LOA = 78.01, GT = 2020)]  # LOA corrected according to TURBOBAT
ACTIVE_PS[VESSEL_NUMBER == "IOTC000879", `:=` (LOA = 108, GT = 4089)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000907", `:=` (LOA = 104.3, GT = 3716)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC001238", `:=` (LOA = 56.84, GT = 1096)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC003810", `:=` (LOA = 84.19, GT = 2319)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC003874", `:=` (LOA = 84.12, GT = 2319)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC004935", `:=` (LOA = 67.2, GT = 1817)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC008281", `:=` (LOA = 95.8, GT = 2937)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC015113", `:=` (LOA = 89.4, GT = 2667)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC015115", `:=` (LOA = 89.4, GT = 2667)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000182", `:=` (LOA = 73.02, GT = 2160)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000897", `:=` (LOA = 79, GT = 1948)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000898", `:=` (LOA = 79, GT = 1948)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000902", `:=` (LOA = 72.5, GT = 1413)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000903", `:=` (LOA = 79, GT = 1948)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000904", `:=` (LOA = 85, GT = 2660)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000905", `:=` (LOA = 85, GT = 2660)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000136", `:=` (LOA = 67.44, GT = 2167)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000138", `:=` (LOA = 101.66, GT = 4428)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000140", `:=` (LOA = 71.35, GT = 2232)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000141", `:=` (LOA = 71.35, GT = 2232)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000143", `:=` (LOA = 71.35, GT = 2232)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000353", `:=` (LOA = 67.3, GT = 1606)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000357", `:=` (LOA = 78.33, GT = 1737)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000368", `:=` (LOA = 79.8, GT = 2109)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000370", `:=` (LOA = 67.3, GT = 1596)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000373", `:=` (LOA = 67.3, GT = 1598)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000814", `:=` (LOA = 94.79, GT = 3870)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC003575", `:=` (LOA = 84.1, GT = 2319)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC003606", `:=` (LOA = 84.14, GT = 3296)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC013979", `:=` (LOA = 89.4, GT = 2667)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC014063", `:=` (LOA = 89.4, GT = 2667)]

# Harmonize GT
ACTIVE_PS[VESSEL_NUMBER == "IOTC000346", GT := 957] # TURBOBAT
ACTIVE_PS[VESSEL_NUMBER == "IOTC000347", GT := 729] # TURBOBAT
ACTIVE_PS[VESSEL_NUMBER == "IOTC000348", GT := 828] # TURBOBAT
ACTIVE_PS[VESSEL_NUMBER == "IOTC000349", GT := 807] # TURBOBAT
ACTIVE_PS[VESSEL_NUMBER == "IOTC000350", GT := 840] # TURBOBAT
ACTIVE_PS[VESSEL_NUMBER == "IOTC000351", GT := 959] # TURBOBAT
ACTIVE_PS[VESSEL_NUMBER == "IOTC000352", GT := 959] # TURBOBAT
ACTIVE_PS[VESSEL_NUMBER == "IOTC000361", GT := 957] # TURBOBAT
ACTIVE_PS[VESSEL_NUMBER == "IOTC001765", GT := 1200]  # http://map.seafdec.org/downloads/pdf/Observation%20Report%20on%20Tuna%20Purse%20Seine%20Fishing%20Operation%20around%20Schychelle%20Waters%20Onboard%20Nippon%20Maru%209%20November%201992%20to%207%20January%201993.pdf

# Fill missing values of GT
#ACTIVE_PS[is.na(GT)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000162", GT := 2165]  # TURBOBAT
ACTIVE_PS[VESSEL_NUMBER == "IOTC000191", GT := 2400]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000353", GT := 1606]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000355", GT := 1558] # TURBOBAT
ACTIVE_PS[VESSEL_NUMBER == "IOTC000356", GT := 1585] # TURBOBAT
ACTIVE_PS[VESSEL_NUMBER == "IOTC000357", GT := 1737]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000358", GT := 1737]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000359", GT := 1737]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000360", GT := 1606]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000362", GT := 1609]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000363", GT := 1600]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000364", GT := 1609]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000367", GT := 1600]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000368", GT := 2109]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000369", GT := 2227]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000370", GT := 1596]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000371", GT := 1383]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000372", GT := 1383]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000373", GT := 1598]
ACTIVE_PS[VESSEL_NUMBER == "IOTC001204", GT := 999] # https://www.balticshipping.com/vessel/imo/8210766
ACTIVE_PS[VESSEL_NUMBER == "IOTC001282", GT := 1096]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000160", `:=` (VESSEL = "INTERTUNA CUATRO", LOA = 105, GT = 4164)]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000163", GT := 2336]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000163", GT := 2336]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000811", GT := 4406]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000878", GT := 4406]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000897", GT := 1948]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000898", GT := 1948]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000902", GT := 1413]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000903", GT := 1948]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000904", GT := 2660]
ACTIVE_PS[VESSEL_NUMBER == "IOTC000905", GT := 2660]
ACTIVE_PS[VESSEL_NUMBER == "IOTC001396", GT := 1095] # RAV
ACTIVE_PS[VESSEL_NUMBER == "IOTC001579", GT := 1094] # RAV
ACTIVE_PS[VESSEL_NUMBER == "IOTC001729", GT := 1094] # RAV
ACTIVE_PS[VESSEL_NUMBER == "IOTC001752", GT := 1016] # RAV

# Estimate GT from LOA-GT relationship
PS_GT_LOA = unique(ACTIVE_PS[!is.na(GT), .(VESSEL_NUMBER, LOA, GT)])
LM_PS_GT_LOA = lm(GT~LOA, data = PS_GT_LOA)

PS_GT_LOA_PLOT = 
  ggplot(data = PS_GT_LOA, aes(x = LOA, y = GT)) +
  geom_point(color = alpha("red", 0.5)) + 
  labs(x = "Length overall (m)", y = "Gross tonnage (t)") + 
  scale_y_continuous(labels = function(x) prettyNum(x, big.mark = ",")) + 
theme_bw()

NEWD = data.table(ACTIVE_PS[is.na(GT), .(VESSEL_NUMBER, LOA)])
NEWD[, GT := predict.lm(LM_PS_GT_LOA, NEWD)]

ACTIVE_PS[VESSEL_NUMBER %in% NEWD$VESSEL_NUMBER, GT := NEWD$GT]

# Remove French purse seiners in 2020 that were not active

ACTIVE_PS = ACTIVE_PS[!(YEAR == 2020 & VESSEL_NUMBER %in% c("IOTC000358", "IOTC000359", "IOTC000360", "IOTC000365", "IOTC000366", "IOTC016428", "IOTC016513"))]

# SUPPORT VESSELS ####

# Format the year
ACTIVE_SP[, YEAR := as.numeric(YEAR)]

# Correct error in IOTC number
ACTIVE_SP[VESSEL_NUMBER == "IOTC016116", VESSEL_NUMBER := "IOTC015116"]

# Harmonize names
ACTIVE_SP[, VESSEL := trimws(VESSEL)]

# Harmonize gear and vessel type
ACTIVE_SP[, GEAR := "Supply Vessel Purse Seiners"]
ACTIVE_SP[, VESSEL_TYPE := "Supply vessel (purse seiners)"]

# Harmonize LOA and GT
ACTIVE_SP[VESSEL_NUMBER == "IOTC015116", GT := 287]
ACTIVE_SP[VESSEL_NUMBER == "IOTC003590", `:=` (LOA = 40, GT = 420)]
ACTIVE_SP[VESSEL_NUMBER == "IOTC003828", `:=` (LOA = 29.83)]
ACTIVE_SP[VESSEL_NUMBER == "IOTC003599", `:=` (LOA = 38.49, GT = 488)]
ACTIVE_SP[VESSEL_NUMBER == "IOTC000880", `:=` (LOA = 33.9, GT = 264)]
ACTIVE_SP[VESSEL_NUMBER == "IOTC008744", `:=` (LOA = 36, GT = 245)]
ACTIVE_SP[VESSEL_NUMBER == "IOTC000894", `:=` (LOA = 44.05, GT = 393)]
ACTIVE_SP[VESSEL_NUMBER == "IOTC004979", `:=` (LOA = 37.55, GT = 369)]
ACTIVE_SP[VESSEL_NUMBER == "IOTC008298", `:=` (GT = 470)]
ACTIVE_SP[VESSEL_NUMBER == "IOTC000813", `:=` (LOA = 32.16, GT = 315)]
ACTIVE_SP[VESSEL_NUMBER == "IOTC000913", `:=` (LOA = 35.13, GT = 421)]
ACTIVE_SP[VESSEL_NUMBER == "IOTC016462", `:=` (LOA = 34.76)]
ACTIVE_SP[VESSEL_NUMBER == "IOTC004980", `:=` (LOA = 35.2, GT = 193)]
ACTIVE_SP[VESSEL_NUMBER == "IOTC016190", `:=` (LOA = 40, GT = 193)]
ACTIVE_SP[VESSEL_NUMBER == "IOTC016626", `:=` (LOA = 46.3, GT = 497)]

# Correction of GT
ACTIVE_SP[VESSEL_NUMBER == "IOTC004976", `:=` (GT = 235)]   #https://www.vesselfinder.com/vessels/details/9156929

# LONGLINERS ####


l_info("Information on purse seiners consolidated!")